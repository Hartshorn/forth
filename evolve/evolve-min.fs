include random.fs 70 constant W 30 constant H W H * constant L 50 constant PE variable ps L cells allot variable as L cells allot : reset_all ps  L cells erase as L cells erase clearstack page cr ; reset_all : xy_to_loc W * + ; : rng8 8 random 1+ ; : 8Rnd 8 0 do rng8 loop ; : rngW W random ; : rngH H random ; : center W 2 / H 2 / xy_to_loc ; : rndloc rngW rngH xy_to_loc ; : @idx cells + @ ; : aloop L 0 do as i @idx dup if drop ." A" else drop ." _" then loop ; : ploop L 0 do ps i @idx dup if drop ." P" else drop ." _" then loop ; : arrayloop aloop ploop ; : show_world H 0 do cr ." |" W 0 do i j 2dup xy_to_loc as swap @idx 0 or if ." M" else  xy_to_loc ps swap @idx 0 or if ." 4" else space then then loop ." |" loop clearstack quit ; : Four, , , , , ; : Eight, , , , , , , , , ; : ^gen 8Rnd CREATE Eight, ; : ^ani CREATE Four, ; : @loc @ ; : >loc swap ! ; : @enr 1 cells + @ ; : >enr swap 1 cells + +! ; : @dir 2 cells + @ ; : >dir swap 2 cells + +! ; : @gen 3 cells + @ ; : idx@gen swap @gen swap cells + @ ; : gen_lp cr 8 0 do dup i idx@gen . cr loop ; : rev3 swap rot ; : >>ani over @loc cells + ! ; : >>plt 1 rev3 cells + ! ; : >>rndplt 1 ps rndloc cells + ! ; : hasplant? ps swap @idx ; : a/eat dup >r @loc hasplant? r> swap 0 or if PE >enr else drop then ; ^gen gs gs 0 500 center ^ani an an as >>ani